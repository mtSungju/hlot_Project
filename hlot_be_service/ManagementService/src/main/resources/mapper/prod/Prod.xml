<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mt.mms.prod.mapper.ProdMapper">

    <select id="selectProds" resultType="org.mt.mms.prod.vo.ProdVO" parameterType="hashmap">
        SELECT /* org.mt.mms.company.mapper.ProdMapper.selectProds : PROD 목록조회 */
            ESTIMATE_ID
             , ORDER_NO
             , PROD_NM
             , DETAIL_PROD_NM
             , CLIENT_UNIT_PRICE
             , PROV_PROD_PRICE
             , DC_PER
             , QUANTITY
             , REGIST_USER_NAME
             , REGIST_DATE
             , DEL_YN
        FROM PROD
        WHERE 1=1
        <if test="id != null and id != '' ">
            AND ESTIMATE_ID = #{id}
        </if>
        <if test="prodNm != null and prodNm !='' ">
            AND PROD_NM LIKE '%'#{prodNm}'%'
        </if>

        <if test="detailProdNm != null and detailProdNm !='' ">
            AND DETAIL_PROD_NM LIKE '%'#{detailProdNm}'%'
        </if>

    </select>

    <insert id="insertProd" parameterType="org.mt.mms.prod.vo.ProdVO">
        INSERT INTO PROD /* org.mt.mms.prod.mapper.ProdMapper.insertProd : PROD 등록 */
        (
         ESTIMATE_ID
        , ORDER_NO
        , PROD_NM
        , DETAIL_PROD_NM
        , CLIENT_UNIT_PRICE
        , PROV_PROD_PRICE
        , DC_PER
        , QUANTITY
        , REGIST_USER_NAME
        )
        VALUES
        (
          #{estimateId}
        , (SELECT IFNULL(MAX(ORDER_NO),0) +1
           FROM PROD ALIAS_FOR_SUBQUERY
           WHERE ESTIMATE_ID=#{estimateId}
        )
        , #{prodNm}
        , #{detailProdNm}
        , #{clientUnitPrice}
        , #{provProdPrice}
        , #{dcPer}
        , #{quantity}
        , #{registUserName}
        )
    </insert>
</mapper>
