<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mt.mms.topContr.mapper.TopContrMapper">
    <select id="getTopContrs" resultType="org.mt.mms.topContr.vo.TopContrVO">

        SELECT
            TOP_CONTR_ID,
            TOP_CONTR_NM,
            TOP_CONTR_DIV,
            CLIENT_COMP,
            TOP_CONTR_DATE,
            CONTR_ST_DATE,
            CONTR_END_DATE,
            PROD_NM,
            CONTR_AMOUNT,
            DELIVERY_DEADLINE,
            DEMAND_INST_NM,
            REGIST_USER_NAME,
            REGIST_DATE,
            DEL_YN,
            TOP_CONTR_FILE_ID
        FROM
            TOP_CONTR
        WHERE DEL_YN = 'N'
    </select>

    <insert id="newTopContr" parameterType="org.mt.mms.topContr.vo.TopContrVO">
        INSERT INTO TOP_CONTR
        (
            TOP_CONTR_ID,
            TOP_CONTR_NM,
            TOP_CONTR_DIV,
            CLIENT_COMP,
            TOP_CONTR_DATE,
            CONTR_ST_DATE,
            CONTR_END_DATE,
            PROD_NM,
            CONTR_AMOUNT,
            DELIVERY_DEADLINE,
            DEMAND_INST_NM,
            REGIST_USER_NAME,
            REGIST_DATE,
            DEL_YN,
            TOP_CONTR_FILE_ID
        )
        VALUES
        (
            CONCAT('20240402BTCO',NEXTVAL(HLOT_SEQ)),
            #{topContrNm},
            #{topContrDiv},
            #{clientComp},
            #{topContrDate},
            #{contrStDate},
            #{contrEndDate},
            #{prodNm},
            #{contrAmount},
            #{deliveryDeadline},
            #{demandInstNm},
            '최성주',
            sysdate(),
            'N',
            #{topContrFileId}
        )
    </insert>

    <select id="one" resultType="org.mt.mms.topContr.vo.TopContrVO" parameterType="string">
        SELECT
            TOP_CONTR_ID,
            TOP_CONTR_NM,
            TOP_CONTR_DIV,
            CLIENT_COMP,
            TOP_CONTR_DATE,
            CONTR_ST_DATE,
            CONTR_END_DATE,
            PROD_NM,
            CONTR_AMOUNT,
            DELIVERY_DEADLINE,
            DEMAND_INST_NM,
            TOP_CONTR_FILE_ID,
            FILE_ID,
            FILE_PATH,
            ORIGN_FILE_NAME,
            CHANGE_FILE_NAME
        FROM
            TOP_CONTR TC LEFT OUTER JOIN ATTACHMENT A
            ON TC.TOP_CONTR_FILE_ID  = A.FILE_ID
        WHERE TOP_CONTR_ID  = #{topContrId}
    </select>

    <update id="updateTopContr" parameterType="org.mt.mms.topContr.vo.TopContrVO">
        UPDATE TOP_CONTR
        SET
        TOP_CONTR_NM 	= #{topContrNm},
        TOP_CONTR_DIV 	= #{topContrDiv},
        CLIENT_COMP	    = #{clientComp},
        TOP_CONTR_DATE 	= #{topContrDate},
        CONTR_ST_DATE 	= #{contrStDate},
        CONTR_END_DATE 	= #{contrEndDate},
        PROD_NM 		= #{prodNm},
        CONTR_AMOUNT 	= #{contrAmount},
        DELIVERY_DEADLINE   = #{deliveryDeadline},
        DEMAND_INST_NM 	    = #{demandInstNm},
        TOP_CONTR_FILE_ID   = #{topContrFileId},
        MODIFY_DATE         = SYSDATE(),
        MODIFY_USER_NAME    = '최성주'
        WHERE
        TOP_CONTR_ID = #{topContrId}
    </update>

    <update id="deleteTopContr" parameterType="java.util.ArrayList">

            UPDATE TOP_CONTR SET
            DEL_YN = 'Y'
            WHERE
            TOP_CONTR_ID IN
        <foreach collection="deldata" open="(" close=")" separator="," item="item">
            #{item}
        </foreach>
    </update>

</mapper>
